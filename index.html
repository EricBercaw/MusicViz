<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' https://sdk.scdn.co;
        connect-src 'self' https://api.spotify.com https://accounts.spotify.com;
        img-src 'self' data: https:;
        style-src 'self' 'unsafe-inline'
      ">
  <title>Spotify Live Data (PKCE)</title>
  <style>
    :root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
    body { margin: 0; background:#0b0b0f; color:#e6e6e6; }
    header { padding: 16px 20px; display:flex; gap:12px; align-items:center; border-bottom:1px solid #222; }
    button { padding:10px 14px; border-radius:10px; border:0; background:#1db954; color:black; font-weight:700; cursor:pointer; }
    button.secondary { background:#2a2a2a; color:#ddd; }
    main { padding:20px; display:grid; gap:16px; max-width:900px; margin:0 auto; }
    .card { background:#111318; border:1px solid #222; border-radius:14px; padding:16px; }
    .row { display:flex; align-items:center; gap:12px; }
    .art { width:64px; height:64px; border-radius:8px; background:#333; object-fit:cover; }
    code, pre { background:#0f1320; color:#cfd7ff; padding:8px 10px; border-radius:8px; display:block; overflow:auto; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; }
    .meter { height:8px; background:#222; border-radius:999px; overflow:hidden; }
    .meter > div { height:100%; background:#1db954; width:0%; transition: width 0.35s linear; }
    .muted { color:#9aa3b2; }
  </style>
  <script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>
<body>
  <header>
    <h3 style="margin:0">Spotify Live Data (PKCE)</h3>
    <button id="btnAuth">Connect to Spotify</button>
    <button id="btnLogout" class="secondary" title="Clear token">Logout</button>
    <span id="whoami" class="muted"></span>
  </header>
  <main>
    <section class="card">
      <h4>Now Playing</h4>
      <div class="row">
        <img id="art" class="art" />
        <div>
          <div id="title" style="font-weight:700">—</div>
          <div id="artist" class="muted">—</div>
          <div id="album" class="muted">—</div>
        </div>
      </div>
      <div style="margin-top:12px" class="mono">
        <span id="position">0:00</span> / <span id="duration">0:00</span>
        <div class="meter" style="margin-top:6px"><div id="progress"></div></div>
      </div>
    </section>

    <section class="card">
      <h4>Audio Features</h4>
      <div class="grid mono">
        <div>tempo: <span id="tempo">—</span></div>
        <div>energy: <span id="energy">—</span></div>
        <div>danceability: <span id="danceability">—</span></div>
        <div>valence: <span id="valence">—</span></div>
        <div>key: <span id="key">—</span></div>
        <div>mode: <span id="mode">—</span></div>
      </div>
    </section>

    <section class="card">
      <h4>Auth / Debug</h4>
      <pre id="raw" class="mono" style="max-height:240px"></pre>
    </section>
  </main>
  <script src="/index.js"></script>
</body>
</html>
